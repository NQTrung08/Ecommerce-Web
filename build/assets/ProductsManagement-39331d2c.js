var M=Object.defineProperty;var q=(s,e,a)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var g=(s,e,a)=>(q(s,typeof e!="symbol"?e+"":e,a),a);import{p as d,j as t,P as v,C as B}from"./mui-a50be5b6.js";import{P as V}from"./PageHeader-2b351038.js";import{G as S,a2 as K,T as G,r as m,N as H}from"./antd-4509dcf0.js";import{N as Y,_ as z,u as W,m as Q}from"./index-cacf817c.js";import{G as X}from"./product-ce657c60.js";import{S as J}from"./SubmenuTrigger-9cf6148c.js";import{u as Z,P as ee}from"./Pagination-ed977979.js";import{E as te}from"./Empty-25eec715.js";import"./DocumentTitle-0f80adc2.js";import"./config-e16ab0ea.js";import"./Spring-81dcc22e.js";const se=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),P=s=>Array.isArray(s)&&s.every(e=>typeof e=="object"&&!(e instanceof Array)),ae=s=>Array.isArray(s)&&s.every(e=>Array.isArray(e)),ne=s=>Array.from(s.map(e=>Object.keys(e)).reduce((e,a)=>new Set([...e,...a]),[])),re=(s,e)=>{e=e||ne(s);let a=e,n=e;P(e)&&(a=e.map(i=>i.label),n=e.map(i=>i.key));const c=s.map(i=>n.map(l=>ie(l,i)));return[a,...c]},ie=(s,e)=>{const a=s.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(n,c,i,l){const o=n[c];if(o==null)l.splice(1);else return o},e);return a===void 0?s in e?e[s]:"":a},ce=s=>typeof s>"u"||s===null?"":s,E=(s,e=",",a='"')=>s.filter(n=>n).map(n=>n.map(c=>ce(c)).map(c=>`${a}${c}${a}`).join(e)).join(`
`),le=(s,e,a,n)=>E(e?[e,...s]:s,a,n),oe=(s,e,a,n)=>E(re(s,e),a,n),de=(s,e,a,n)=>e?`${e.join(a)}
${s}`:s.replace(/"/g,'""'),F=(s,e,a,n)=>{if(P(s))return oe(s,e,a,n);if(ae(s))return le(s,e,a,n);if(typeof s=="string")return de(s,e,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},I=(s,e,a,n,c)=>{const i=F(s,a,n,c),l=se()?"application/csv":"text/csv",o=new Blob([e?"\uFEFF":"",i],{type:l}),p=`data:${l};charset=utf-8,${e?"\uFEFF":""}${i}`,u=window.URL||window.webkitURL;return typeof u.createObjectURL>"u"?p:u.createObjectURL(o)},L={data:d.oneOfType([d.string,d.array,d.func]).isRequired,headers:d.array,target:d.string,separator:d.string,filename:d.string,uFEFF:d.bool,onClick:d.func,asyncOnClick:d.bool,enclosingCharacter:d.string},T={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},pe={target:"_blank"};class N extends S.Component{constructor(e){super(e),this.state={}}buildURI(){return I(...arguments)}componentDidMount(){const{data:e,headers:a,separator:n,enclosingCharacter:c,uFEFF:i,target:l,specs:o,replace:p}=this.props;this.state.page=window.open(this.buildURI(e,i,a,n,c),l,o,p)}getWindow(){return this.state.page}render(){return null}}g(N,"defaultProps",Object.assign(T,pe)),g(N,"propTypes",L);var b;let me=(b=class extends S.Component{constructor(e){super(e),this.buildURI=this.buildURI.bind(this)}buildURI(){return I(...arguments)}handleLegacy(e,a=!1){if(window.navigator.msSaveOrOpenBlob){e.preventDefault();const{data:n,headers:c,separator:i,filename:l,enclosingCharacter:o,uFEFF:p}=this.props,u=a&&typeof n=="function"?n():n;let j=new Blob([p?"\uFEFF":"",F(u,c,i,o)]);return window.navigator.msSaveBlob(j,l),!1}}handleAsyncClick(e){const a=n=>{if(n===!1){e.preventDefault();return}this.handleLegacy(e,!0)};this.props.onClick(e,a)}handleSyncClick(e){if(this.props.onClick(e)===!1){e.preventDefault();return}this.handleLegacy(e)}handleClick(){return e=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(e):this.handleSyncClick(e);this.handleLegacy(e)}}render(){const{data:e,headers:a,separator:n,filename:c,uFEFF:i,children:l,onClick:o,asyncOnClick:p,enclosingCharacter:u,...j}=this.props,w=typeof window>"u"?"":this.buildURI(e,i,a,n,u);return t.jsx("a",{download:c,...j,ref:C=>this.link=C,target:"_self",href:w,onClick:this.handleClick(),children:l})}},g(b,"defaultProps",T),g(b,"propTypes",L),b);const ue=me;let k=[];const R=async s=>{try{k=(await X(s==="publish",s==="drafted",s==="deleted")).data.productsWithCounts.map(i=>{var o,p;const l=i._id.slice(-3);return{id:i._id,sku:i.sku||`SKU-${l}`,image:((o=i.product_img)==null?void 0:o[0])||"",name:i.product_name,stock:i.product_quantity||0,price:i.product_price||0,category:((p=i.category_id)==null?void 0:p.category_name)||"Chưa có",rateCount:i.avgRating||Math.floor(Math.random()*5)+1,date:i.createdAt||new Date().toISOString(),status:i.isPublic?"publish":i.isDeleted?"deleted":"drafted"}}),console.log("Products",k)}catch(e){console.error("Error fetching products data:",e)}},A=()=>k,O=({product:s,activeCollapse:e,handleCollapse:a})=>{const{stock:n}=s;return t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(K,{}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center",children:t.jsx("img",{src:s.image,alt:"product"})}),t.jsx("h6",{className:"text-sm max-w-[70px] truncate",children:s.sku})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{className:`collapse-btn ${e===s.sku?"active":""}`,"aria-label":"Toggle view",onClick:()=>a(s.sku),children:t.jsx("i",{className:"icon icon-caret-down-solid"})}),t.jsx(Y,{to:"/product-editor","aria-label":"Edit",children:t.jsx("i",{className:"icon icon-pen-to-square-regular"})}),t.jsx(J,{})]})]}),t.jsx(B,{in:e===s.sku,children:t.jsx("table",{className:"basic-table",children:t.jsxs("tbody",{children:[t.jsx("tr",{children:t.jsx("td",{colSpan:2,children:"Product"})}),t.jsx("tr",{children:t.jsx("td",{colSpan:2,children:t.jsxs("div",{className:"flex gap-2.5",children:[t.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:t.jsx("img",{src:s.image,alt:"product"})}),t.jsx("h6",{className:"text-sm max-w-[155px]",children:s.name})]})})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["SKU: ",s.sku]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Stock status:",n==null?"On Demand":t.jsxs("span",{children:[t.jsx("span",{className:`${n!==0?"text-green":"text-red"}`,children:n!==0?n>=10?" In stock ":" Low Inventory ":" Out of stock "}),"(",n,")"]})]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Price: $",s.price]})}),t.jsx("tr",{children:t.jsxs("td",{colSpan:2,children:["Category:",t.jsx("button",{className:"capitalize text-accent ml-1",children:s.category})]})})]})})})]})};O.propTypes={product:v.object.isRequired,activeCollapse:v.string.isRequired,handleCollapse:v.func.isRequired};const xe=z(G).withConfig({displayName:"styles__StyledTable",componentId:"sc-k8b1p0-0"})(["flex-grow:1;.ant-spin-nested-loading,.ant-spin-container{height:100%;}.ant-spin-container{display:flex;flex-direction:column;}.ant-table{flex-grow:1;background:transparent;}.ant-table-thead .ant-table-cell{background:var(--widget);padding:30px 15px 20px !important;border-bottom:1px solid var(--border) !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{text-align:right;padding-right:24px !important;}}.ant-table-tbody .ant-table-cell{border:none !important;padding:30px 15px !important;&:first-of-type{padding-left:24px !important;}&:last-of-type{padding-right:24px !important;}}"]),he=()=>{const{width:s}=W(),[e,a]=m.useState([]),[n,c]=m.useState("publish"),[i,l]=m.useState(""),[o,p]=m.useState([]),[u,j]=m.useState(!1),[f,w]=m.useState("");m.useEffect(()=>{(async()=>{console.log("category",n),await R(n),a(A())})()},[n,u]);const C=e.filter(r=>r.name.toLowerCase().includes(f.toLowerCase())||r.sku.toLowerCase().includes(f.toLowerCase())||r.category.toLowerCase().includes(f.toLowerCase())),h=Z((()=>C)(),8);m.useEffect(()=>{l("")},[h.currentPage,s]);const D=r=>{l(i===r?"":r)},U=(r,x)=>{p(y=>x?[...y,r]:y.filter($=>$!==r))},_=[{title:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("i",{className:"icon-image-regular text-[26px]"})}),dataIndex:"image",width:45,render:r=>t.jsx("div",{className:"img-wrapper w-[45px] h-[45px] flex items-center justify-center",children:t.jsx("img",{src:r,alt:"sản phẩm"})})},{title:"Tên sản phẩm",dataIndex:"name",render:r=>t.jsx("span",{className:"inline-block h6 !text-sm max-w-[155px]",children:r})},{title:"SKU",dataIndex:"sku"},{title:"Tồn kho",dataIndex:"stock",width:130,render:r=>t.jsx("div",{className:"flex items-center gap-5",children:r==null?"Theo yêu cầu":t.jsxs("span",{children:[t.jsx("span",{className:`${r!==0?"text-green":"text-red"}`,children:r!==0?r>=10?"Còn hàng ":"Tồn kho thấp ":"Hết hàng "}),"(",r,")"]})})},{title:"Giá",dataIndex:"price",render:r=>{const x=r?r.toLocaleString("vi-VN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00";return t.jsxs("span",{children:["₫",x]})}},{title:"Ngành hàng",dataIndex:"category",render:r=>t.jsx("button",{className:"text-accent capitalize",children:r})},{title:"Đánh giá",dataIndex:"rateCount",render:r=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("i",{className:`icon icon-star-${r!==0?"solid":"regular"} text-lg leading-none`}),r!==0&&t.jsxs("span",{className:"mt-1",children:["(",r,")"]})]})},{title:"Ngày",dataIndex:"date",render:r=>t.jsx("div",{className:"flex flex-col items-start",children:t.jsx("span",{className:"font-bold text-header w-fit",children:r&&H(r).format("DD/MM/YYYY")})}),responsive:["lg"]}];return t.jsxs("div",{className:"flex flex-col flex-1",children:[t.jsx("div",{className:"flex flex-wrap gap-2 mb-4"}),t.jsxs("div",{className:"flex flex-col-reverse gap-4 mt-4 mb-5 items-center justify-center md:flex-row md:justify-between md:items-end md:mt-5 md:mb-6",children:[t.jsxs("p",{children:["Xem sản phẩm: ",h.showingOf()]}),t.jsx(Q,{wrapperClass:"lg:w-[326px]",placeholder:"Tìm kiếm sản phẩm",query:f,setQuery:w})]}),console.log("pagination.currentItems()",h.currentItems()),t.jsxs("div",{className:"flex flex-1 flex-col gap-[22px]",children:[s>=768?t.jsx(xe,{columns:[{title:"Chọn",render:(r,x)=>t.jsx("input",{type:"checkbox",checked:o.includes(x.id),onChange:y=>U(x.id,y.target.checked)})},..._],dataSource:h.currentItems(),rowKey:r=>r.sku,locale:{emptyText:t.jsx(te,{text:"Không tìm thấy sản phẩm"})},pagination:!1}):t.jsx("div",{className:"flex flex-col gap-5",children:h.currentItems().map((r,x)=>t.jsx(O,{product:r,handleCollapse:D,activeCollapse:i},`product-${x}`))}),h.maxPage>1&&t.jsx(ee,{pagination:h})]})]})},Ie=()=>{const[s,e]=m.useState([]);return m.useEffect(()=>{(async()=>{await R(),e(A())})()},[]),t.jsxs(t.Fragment,{children:[t.jsx(V,{title:"Quản lý Sản phẩm"}),t.jsx("div",{className:"flex flex-col-reverse gap-4 mb-5 md:flex-col lg:flex-row lg:justify-between",children:t.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:gap-[14px]",children:t.jsxs(ue,{className:"btn btn--outline blue !h-[44px]",data:s,children:["Xuất CSV ",t.jsx("i",{className:"icon-file-export-solid"})]})})}),t.jsx(he,{products:s})]})};export{Ie as default};
