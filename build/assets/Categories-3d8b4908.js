import{j as n}from"./mui-a50be5b6.js";import{r as l,O as b,Q as E,U as H,V as K,X as V,Y as Z,Z as q,$ as z}from"./antd-4509dcf0.js";import{c as G,u as _,a as J,b as W,d as ee}from"./categorie-7552cc64.js";import{P as te}from"./PageHeader-2b351038.js";import{L as ne,k as ae,Q as o}from"./index-cacf817c.js";/* empty css                      */import"./config-e16ab0ea.js";import"./DocumentTitle-0f80adc2.js";const ue=()=>{var k;const[i,v]=l.useState(null),[se,F]=l.useState([]),[g,L]=l.useState([]),[d,u]=l.useState(""),[m,p]=l.useState(null),[C,f]=l.useState(null),[O,x]=l.useState(!1),[r,A]=l.useState("create"),[D,w]=l.useState(!0);l.useEffect(()=>{j()},[]);const j=async()=>{try{const e=await G();F(y(e)),L(I(e)),w(!1)}catch(e){console.error("Failed to fetch categories",e)}},U=e=>{console.log(e)},$=(e,t)=>{console.log("Trigger Select",e,t)},M=(e,t)=>{console.log("Trigger Expand",e,t)},B=async e=>{const t=e.dragNode,a=e.node;if(!a||!t)return;const s=t.key.split("-").pop(),c=a.key.split("-"),P=c.slice(0,c.length-1).join("-"),T=a.pos.split("-").pop(),X=P===""?null:P;try{a.dragOver?await _({categoryIds:[s],newParentId:c[c.length-1],newIndex:T}):await _({categoryIds:[s],newParentId:X,newIndex:T}),o.success("Cập nhật ngành hàng thành công."),j()}catch(Y){console.error("Error updating category:",Y),o.error("Error updating category.")}},y=(e,t=0)=>{let a=[];return e.forEach(s=>{a.push({category_name:s.category_name,_id:s._id,parent_id:s.parent_id,level:t}),s.children&&s.children.length>0&&(a=a.concat(y(s.children,t+1)))}),a},I=e=>({name:"Categories",children:e.map(t=>({name:t.category_name,id:t._id,parentId:t.parent_id,children:t.children?I(t.children).children:[]}))}),N=(e,t="")=>{var s;const a=t?`${t}-${e.id}`:e.id;return{title:n.jsxs("span",{children:[e.name,n.jsx(E,{className:"ml-2 text-blue-500",onClick:()=>h("create",e)}),n.jsx(q,{className:"ml-2 text-green-darker",onClick:()=>h("edit",e)}),n.jsx(z,{className:"ml-2 text-rose-500",onClick:()=>h("delete",e)})]}),key:a,isLeaf:e.children&&e.children.length===0,children:((s=e.children)==null?void 0:s.map(c=>N(c,a)))||[]}},h=(e,t=null)=>{A(e),v(t),u(t?t.name:""),p(null),f(null),x(!0)},Q=e=>{const t=e.fileList[0];t&&(p(t.originFileObj),f(URL.createObjectURL(t.originFileObj)))},R=async()=>{if(!m&&r!=="delete"){o.error("Không có ảnh nào được chọn.");return}try{r==="create"&&d?(await J("",d,m),o.success("Tạo ngành hàng thành công.")):r==="edit"&&i?(await W(i.id,{parent_id:i.parentId,category_name:d,file:m}),o.success("Đã cập nhật ngành hàng thành công.")):r==="delete"&&i&&(await ee(i.id),o.success("Đã xóa ngành hàng thành công.")),j(),S(),x(!1),w(!1)}catch{o.error(`Lỗi khi ${r} ngành hàng.`)}};if(D)return n.jsx(ne,{});const S=()=>{u(""),p(null),f(null)};return n.jsxs("div",{children:[n.jsx(te,{title:"Quản lý ngành hàng"}),n.jsx(ae,{}),n.jsxs("div",{className:"w-full",children:[n.jsx(b,{type:"primary",icon:n.jsx(E,{}),onClick:()=>h("create"),className:"mb-4",children:"Tạo ngành hàng mới"}),n.jsx(H,{className:"draggable-tree",multiple:!0,draggable:!0,defaultExpandAll:!0,showIcon:!1,onDragEnter:U,onDrop:B,onSelect:$,onExpand:M,treeData:(k=g==null?void 0:g.children)==null?void 0:k.map(e=>N(e))})]}),n.jsxs(K,{title:`${r.charAt(0).toUpperCase()+r.slice(1)} ngành hàng`,open:O,onOk:R,onCancel:()=>{x(!1),S()},okText:r==="delete"?"Delete":"Save",cancelText:"Cancel",style:{top:"50%",transform:"translateY(-50%) translateX(70%)"},children:[r!=="delete"&&n.jsxs(n.Fragment,{children:[n.jsx(V,{value:d,onChange:e=>u(e.target.value),placeholder:"Category Name",className:"mb-2"}),n.jsx(Z,{beforeUpload:()=>!1,onChange:Q,children:n.jsx(b,{children:"Tải hình ảnh"})}),C&&n.jsx("img",{src:C,alt:"Preview",className:"mt-2 w-full h-32 object-cover"})]}),r==="delete"&&n.jsx("p",{children:"Bạn có chắc chắn muốn xóa ngành hàng này?"})]})]})};export{ue as default};
