import{j as e}from"./mui-a50be5b6.js";import{P as _}from"./PageHeader-2b351038.js";import{S as C}from"./Spring-81dcc22e.js";import{u as q,C as N}from"./index.esm-b91f836f.js";import{r as h,J as o}from"./antd-4509dcf0.js";import{h as F,Q as d}from"./index-cacf817c.js";import{g as S}from"./categorie-7552cc64.js";import{g as I,u as $,c as E}from"./product-ce657c60.js";import"./DocumentTitle-0f80adc2.js";import"./config-e16ab0ea.js";const L=()=>{const{id:i}=F(),[y,v]=h.useState([]),[g,u]=h.useState([]),{register:m,handleSubmit:f,control:x,formState:{errors:n},setValue:l}=q({defaultValues:{image1:[],productName:"",description:"",salePrice:"",category_id:null,qty:0}});h.useEffect(()=>{const t=async()=>{try{const s=await S();v(s.filter(a=>a.value!=="all"))}catch{d.error("Không thể tải ngành hàng")}},r=async()=>{if(i)try{const s=await I(i);l("productName",s.product_name),l("description",s.product_desc),l("salePrice",s.product_price),l("category_id",s.category_id._id),l("qty",s.product_quantity);const a=s.product_img.map(p=>({url:p}));u(a),l("image1",a)}catch{d.error("Không thể tải dữ liệu sản phẩm")}};t(),r()},[i,l]);const b=async(t,r)=>{var a,p;const s=t.image1.filter(c=>c!=="");console.log(r);try{const P=await(i?$:E)({id:i,product_name:t.productName,product_desc:t.description,product_price:t.salePrice,product_quantity:t.qty,category_id:t.category_id,files:s,isDraft:r,isPublic:!r});r?d.info("Sản phẩm đã được lưu dưới dạng bản nháp!"):d.success(`Sản phẩm đã ${i?"cập nhật":"xuất bản"} thành công!`),console.log("Product response:",P)}catch(c){d.error(`Không thể ${r?"lưu sản phẩm dưới dạng bản nháp":"xuất bản sản phẩm"}. Lý do: ${((p=(a=c.response)==null?void 0:a.data)==null?void 0:p.message)||c.message}`)}},j=t=>{const r=Array.from(t);u(r),l("image1",r)},w=t=>{const r=g.filter((s,a)=>a!==t);u(r),l("image1",r)};return e.jsxs(C,{className:"card flex-1 xl:py-10",children:[e.jsx("h5",{className:"mb-[15px]",children:i?"Chỉnh sửa sản phẩm":"Cài đặt sản phẩm"}),e.jsx("form",{className:"grid gap-5",onSubmit:f(t=>b(t,!1)),children:e.jsxs("div",{className:"flex flex-row w-full gap-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{className:"field-label",htmlFor:"productName",children:"Tên sản phẩm"}),e.jsx("input",{className:o("field-input",{"field-input--error":n.productName}),id:"productName",placeholder:"Nhập tên sản phẩm",...m("productName",{required:!0})})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{className:"field-label",htmlFor:"description",children:"Mô tả"}),e.jsx("textarea",{className:o("field-input",{"field-input--error":n.description}),id:"description",placeholder:"Nhập mô tả",...m("description",{required:!0})})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{className:"field-label",htmlFor:"salePrice",children:"Giá bán"}),e.jsx("input",{className:o("field-input",{"field-input--error":n.salePrice}),id:"salePrice",type:"number",placeholder:"Nhập giá bán",...m("salePrice",{required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"field-label mb-2.5",children:"Hình ảnh sản phẩm"}),e.jsx(N,{name:"image1",control:x,render:({field:t})=>e.jsxs("div",{className:"border-2 border-slate-200 rounded-lg p-4",children:[e.jsx("label",{htmlFor:"image-upload",className:"btn btn-primary cursor-pointer",children:"Choose Image"}),e.jsx("input",{id:"image-upload",type:"file",name:"image1",onChange:r=>j(r.target.files),multiple:!0,className:"hidden"}),e.jsx("div",{className:"image-preview-container mt-4",children:g.map((r,s)=>e.jsx("div",{className:"image-preview relative w-full h-48 border border-slate-300 rounded-lg overflow-hidden flex justify-center items-center",children:r?e.jsx("img",{src:r.url||URL.createObjectURL(r),alt:`preview-${s}`,className:"preview-img object-cover w-full h-full cursor-pointer",onClick:()=>w(s)}):e.jsxs("label",{htmlFor:`image-upload-${s}`,className:"media-dropzone w-full h-full flex justify-center items-center cursor-pointer border-2 border-dashed border-slate-300 rounded-lg",children:[e.jsx("span",{className:"text-gray-500",children:"Select Image"}),e.jsx("input",{id:`image-upload-${s}`,type:"file",name:`image${s+1}`,onChange:a=>j(a.target.files),className:"hidden"})]})},s))})]})})]})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{className:"field-label",htmlFor:"qty",children:"Số lượng"}),e.jsx("input",{className:o("field-input",{"field-input--error":n.qty}),id:"qty",type:"number",placeholder:"Nhập số lượng",...m("qty",{required:!0})})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{className:"field-label",htmlFor:"category",children:"Ngành hàng"}),e.jsx(N,{name:"category_id",control:x,render:({field:t})=>e.jsxs("select",{className:o("field-input",{"field-input--error":n.category_id}),id:"category",...t,children:[e.jsx("option",{value:"",children:"Chọn ngành hàng"}),y.map(r=>e.jsx("option",{value:r._id,children:r.category_name},r._id))]})})]}),e.jsxs("div",{className:"grid gap-2 mt-5 sm:grid-cols-2 sm:mt-10 md:mt-11",children:[i?null:e.jsx("button",{type:"button",className:"btn btn--primary",onClick:f(t=>b(t,!0)),children:"Lưu thành bản nháp"}),e.jsx("button",{className:"btn btn--secondary",type:"submit",children:i?"Cập nhật thông tin":"Xuất bản sản phẩm"})]})]})]})})]})},J=()=>e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Product Editor"}),e.jsx(L,{})]});export{J as default};
