import{P as p,j as e,C as _}from"./mui-a50be5b6.js";import{P as A}from"./PageHeader-2b351038.js";import{T as D,N as l,r as a}from"./antd-4509dcf0.js";import{S as P}from"./Spring-81dcc22e.js";import{_ as E,t as F,i as I,u as O,T as g,L as B}from"./index-cacf817c.js";import{C as L}from"./Trend-c0506e69.js";import{S as $}from"./index-23a69d03.js";import{u as M,P as U}from"./Pagination-ed977979.js";import{e as q}from"./helpers-f9dc12f1.js";import{E as K}from"./Empty-25eec715.js";import{T as z}from"./columnDefs-bd448cff.js";import{a as Y,U as G}from"./config-e16ab0ea.js";import"./DocumentTitle-0f80adc2.js";import"./RatingStars-a495c0a4.js";import"./SubmenuTrigger-9cf6148c.js";import"./Timestamp-723259f5.js";import"./Counter-dfd40b33.js";const H=E(D).withConfig({displayName:"styles__StyledTable",componentId:"sc-kirxdx-0"})(["margin-bottom:26px;flex-grow:1;.ant-table-thead{position:relative;&::after{content:'';position:absolute;left:0;bottom:0;height:1px;width:100%;opacity:.6;background:var(--input-border);}.ant-table-cell{background:var(--widget) !important;padding:30px 26px 24px !important;border:none !important;}}.ant-table-tbody{tr:nth-child(odd) .ant-table-cell{background:"," !important;}tr:nth-child(even) .ant-table-cell{background:var(--widget) !important;}.ant-table-cell{border:none;padding:24px 26px 26px;}}"],F("theme",{light:"var(--body)",dark:"rgba(39, 50, 65, .2)"})),y=({transaction:s,activeCollapse:i,handleCollapse:t})=>{var o,m,d;return console.log("transaction",s),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[18px]",children:[e.jsx("div",{className:"img-wrapper w-[40px] h-[40px] flex items-center justify-center shrink-0",children:e.jsx("img",{className:"max-w-[30px]",src:(o=s==null?void 0:s.seller)==null?void 0:o.logo,alt:(m=s==null?void 0:s.seller)==null?void 0:m.name})}),e.jsx("span",{className:"h6 hidden truncate xs:inline",children:(d=s==null?void 0:s.seller)==null?void 0:d.name})]}),e.jsxs("div",{className:"flex items-center gap-2.5 shrink-0",children:[e.jsx("p",{className:"text-sm font-medium",children:l(s==null?void 0:s.timestamp).format("DD.MM.YY, hh:mm")}),e.jsx("button",{className:`collapse-btn ${i===(s==null?void 0:s.sku)?"active":""}`,"aria-label":"Toggle view",onClick:()=>t(s==null?void 0:s.sku),children:e.jsx("i",{className:"icon icon-caret-down-solid"})})]})]}),e.jsx(_,{in:i===s.sku,children:e.jsx("table",{className:"basic-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"SKU"}),e.jsx("td",{children:s.sku})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Method"}),e.jsx("td",{children:s.method})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Type"}),e.jsx("td",{className:"capitalize",children:s.type})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Status"}),e.jsx("td",{children:e.jsx("span",{className:"badge-status",style:{backgroundColor:`var(--${q(s.status)})`,width:"100%"},children:s.status})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Country"}),e.jsx("td",{children:s.country})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Currency"}),e.jsx("td",{children:s.currency})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Fee"}),e.jsxs("td",{children:["$",s.fee]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Tax"}),e.jsx("td",{children:s.tax})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Total"}),e.jsxs("td",{children:["$",(s.fee-s.fee/100*s.tax).toFixed(2)]})]})]})})})]})};y.propTypes={transaction:p.object.isRequired,activeCollapse:p.string.isRequired,handleCollapse:p.func.isRequired};const W=async()=>{try{const s=I("application/json");return(await Y.get(`${G}transaction`,s)).data}catch(s){throw console.error("Failed to fetch reviews",s),s}},X=async()=>{try{return(await W()).map((t,o)=>({sku:t.transactionNo,timestamp:new Date(t.createdAt),method:t.bankCode,type:t.transactionStatus||"unknown",status:t.responseCode==="00"?"Thành công":"Thất bại",amount:t.amount,id:t._id,order_id:t.order_id,transactionNo:t.transactionNo}))}catch(s){throw console.error("Failed to fetch transactions",s),s}},J=()=>{const{width:s}=O(),[i,t]=a.useState(""),[o,m]=a.useState(g[0]),[d,b]=a.useState([]),[T,h]=a.useState([]),[N,S]=a.useState(!0),[f,w]=a.useState(null),[u,v]=a.useState([l().startOf("year"),l()]),c=M(T,6);a.useEffect(()=>{(async()=>{try{const n=await X();b(n),h(n)}catch(n){w("Failed to fetch transactions"),console.error("Error fetching transactions",n)}finally{S(!1)}})()},[]),a.useEffect(()=>{(()=>{const[n,k]=u,R=d.filter(x=>l(x.timestamp).isAfter(n,"day")&&l(x.timestamp).isBefore(k,"day")).sort((x,j)=>o.value==="recent"?l(j.timestamp).isBefore(l(x.timestamp))?1:-1:o.value==="oldest"?l(x.timestamp).isBefore(l(j.timestamp))?1:-1:0);h(R)})()},[u,d,o]);const C=r=>{t(n=>n===r?"":r)};return N?e.jsx(B,{}):f?e.jsx("div",{children:f}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-5 md:flex-row justify-between",children:[e.jsx(L,{wrapperClass:"md:max-w-[275px]",id:"transactionsDate",label:"Ngày giao dịch từ",onChange:v}),e.jsxs("div",{className:"flex flex-col-reverse gap-2.5 md:flex-col md:min-w-[220px]",children:[e.jsxs("p",{className:"md:text-right",children:["Xem giao dịch: ",c.showingOf()]}),e.jsx($,{options:g,value:o,onChange:m})]})]}),e.jsxs(P,{className:"flex flex-col flex-1",children:[s>=768?e.jsx(H,{columns:z,dataSource:c.currentItems(),rowKey:r=>r.sku,locale:{emptyText:e.jsx(K,{text:"Không tìm thấy giao dịch nào"})},pagination:!1}):e.jsx("div",{className:"flex flex-1 flex-col gap-5 mb-[26px]",children:c.currentItems().map(r=>e.jsx(y,{handleCollapse:C,activeCollapse:i,transaction:r},r.sku))}),c.maxPage>1&&e.jsx(U,{pagination:c})]})]})},fe=()=>e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Giao dịch"}),e.jsx(J,{})]});export{fe as default};
