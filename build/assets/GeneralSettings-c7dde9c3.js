import{j as d}from"./mui-a50be5b6.js";import{P as Ie}from"./PageHeader-2b351038.js";import{S as se}from"./Spring-81dcc22e.js";import{r as j,N as ke,G as D,J as Z}from"./antd-4509dcf0.js";import{i as le,a as Fe,c as _e,n as Pe,D as Te,o as Me,Q as Oe}from"./index-cacf817c.js";import{a as ce,U as fe}from"./config-e16ab0ea.js";import{u as Re,C as De}from"./index.esm-b91f836f.js";import{a as Ue}from"./shop-074a834f.js";import"./DocumentTitle-0f80adc2.js";const re=async()=>{const e=le("application/json");return(await ce.get(`${fe}profile/own`,e)).data},Be=async e=>{const r=le("multipart/form-data"),t=new FormData;return t.append("file",e),(await ce.post(`${fe}profile/avatar-own`,t,r)).data},Le=()=>{const[e,r]=j.useState(null),t=Fe(),a=_e();j.useEffect(()=>{(async()=>{try{const c=await re();r(c)}catch(c){console.error("Error fetching user data:",c)}})()},[]);const n=async()=>{try{Pe(),document.cookie="user_login=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",t(Te()),a("/"),window.location.reload()}catch(l){console.error("Logout error:",l)}},s=async l=>{const c=l.target.files[0];if(c)try{await Be(c);const g=await re();r(g)}catch(g){console.error("Failed to update profile picture:",g)}};return e!=null&&e.roleNames,d.jsxs(se,{className:"card flex flex-col items-center justify-center",id:"userProfileCard",children:[d.jsxs("div",{className:"relative mb-3.5",children:[d.jsx("img",{className:"relative rounded-full w-[110px] h-[110px]",src:(e==null?void 0:e.avatar)||"",alt:"User Avatar"}),d.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"profileImageUpload",onChange:s}),d.jsx("label",{htmlFor:"profileImageUpload",className:`absolute z-10 right-0 bottom-0 h-10 w-10 bg-green text-widget rounded-full border-[3px]
                    border-widget border-solid transition hover:bg-green-darker cursor-pointer`,"aria-label":"Change profile picture",children:d.jsx("i",{className:"inline-block icon-camera-solid mt-1"})})]}),d.jsx("h4",{children:e==null?void 0:e.userName}),d.jsxs("p",{className:"subheading-2 mt-6 mb-[18px]",children:["Lần truy cập cuối ",ke().format("DD/MM/YYYY")]}),d.jsx("div",{className:"",onClick:n,children:d.jsx("button",{className:"btn btn--secondary w-full md:max-w-[280px]",children:"Đăng xuất"})})]})};function de(e,r){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&r.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]]);return t}var G;(function(e){e.event="event",e.props="prop"})(G||(G={}));function M(){}function Ke(e){var r,t=void 0;return function(){for(var a=[],n=arguments.length;n--;)a[n]=arguments[n];return r&&a.length===r.length&&a.every(function(s,l){return s===r[l]})||(r=a,t=e.apply(void 0,a)),t}}function L(e){return!!(e||"").match(/\d/)}function J(e){return e==null}function qe(e){return typeof e=="number"&&isNaN(e)}function $e(e){return J(e)||qe(e)||typeof e=="number"&&!isFinite(e)}function Ye(e){var r=j.useRef(e);r.current=e;var t=j.useRef(function(){for(var a=[],n=arguments.length;n--;)a[n]=arguments[n];return r.current.apply(r,a)});return t.current}function ue(e,r){return Array(r+1).join(e)}function Ge(e){var r=e+"",t=r[0]==="-"?"-":"";t&&(r=r.substring(1));var a=r.split(/[eE]/g),n=a[0],s=a[1];if(s=Number(s),!s)return t+n;n=n.replace(".","");var l=1+s,c=n.length;return l<0?n="0."+ue("0",Math.abs(l))+n:l>=c?n=n+ue("0",l-c):n=(n.substring(0,l)||"0")+"."+n.substring(l),t+n}function te(e,r){if(e.value=e.value,e!==null){if(e.createTextRange){var t=e.createTextRange();return t.move("character",r),t.select(),!0}return e.selectionStart||e.selectionStart===0?(e.focus(),e.setSelectionRange(r,r),!0):(e.focus(),!1)}}var Je=Ke(function(e,r){for(var t=0,a=0,n=e.length,s=r.length;e[t]===r[t]&&t<n;)t++;for(;e[n-1-a]===r[s-1-a]&&s-a>t&&n-a>t;)a++;return{from:{start:t,end:n-a},to:{start:t,end:s-a}}}),ze=function(e,r){var t=Math.min(e.selectionStart,r);return{from:{start:t,end:e.selectionEnd},to:{start:t,end:r}}};function He(e,r,t){return Math.min(Math.max(e,r),t)}function ee(e){return Math.max(e.selectionStart,e.selectionEnd)}function Qe(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function We(e){return{from:{start:0,end:0},to:{start:0,end:e.length},lastValue:""}}function me(e,r){return e===void 0&&(e=" "),typeof e=="string"?e:e[r]||" "}function Xe(e){var r=e.currentValue,t=e.formattedValue,a=e.currentValueIndex,n=e.formattedValueIndex;return r[a]===t[n]}function Ze(e,r,t,a,n,s,l){l===void 0&&(l=Xe);var c=n.findIndex(function(I){return I}),g=e.slice(0,c);!r&&!t.startsWith(g)&&(r=g,t=g+t,a=a+g.length);for(var S=t.length,h=e.length,A={},v=new Array(S),y=0;y<S;y++){v[y]=-1;for(var f=0,C=h;f<C;f++){var u=l({currentValue:t,lastValue:r,formattedValue:e,currentValueIndex:y,formattedValueIndex:f});if(u&&A[f]!==!0){v[y]=f,A[f]=!0;break}}}for(var p=a;p<S&&(v[p]===-1||!s(t[p]));)p++;var N=p===S||v[p]===-1?h:v[p];for(p=a-1;p>0&&v[p]===-1;)p--;var V=p===-1||v[p]===-1?0:v[p]+1;return V>N?N:a-V<N-a?V:N}function z(e,r,t,a){var n=e.length;if(r=He(r,0,n),a==="left"){for(;r>=0&&!t[r];)r--;r===-1&&(r=t.indexOf(!0))}else{for(;r<=n&&!t[r];)r++;r>n&&(r=t.lastIndexOf(!0))}return r===-1&&(r=n),r}function er(e){for(var r=Array.from({length:e.length+1}).map(function(){return!0}),t=0,a=r.length;t<a;t++)r[t]=!!(L(e[t])||L(e[t-1]));return r}function rr(e,r,t,a,n,s){s===void 0&&(s=M);var l=Ye(function(f,C){var u,p;return $e(f)?(p="",u=""):typeof f=="number"||C?(p=typeof f=="number"?Ge(f):f,u=a(p)):(p=n(f,void 0),u=a(p)),{formattedValue:u,numAsString:p}}),c=j.useState(function(){return l(J(e)?r:e,t)}),g=c[0],S=c[1],h=function(f,C){f.formattedValue!==g.formattedValue&&S({formattedValue:f.formattedValue,numAsString:f.value}),s(f,C)},A=e,v=t;J(e)&&(A=g.numAsString,v=!0);var y=l(A,v);return j.useMemo(function(){S(y)},[y.formattedValue]),[g,h]}function tr(e){return e.replace(/[^0-9]/g,"")}function ar(e){return e}function nr(e){var r=e.type;r===void 0&&(r="text");var t=e.displayType;t===void 0&&(t="input");var a=e.customInput,n=e.renderText,s=e.getInputRef,l=e.format;l===void 0&&(l=ar);var c=e.removeFormatting;c===void 0&&(c=tr);var g=e.defaultValue,S=e.valueIsNumericString,h=e.onValueChange,A=e.isAllowed,v=e.onChange;v===void 0&&(v=M);var y=e.onKeyDown;y===void 0&&(y=M);var f=e.onMouseUp;f===void 0&&(f=M);var C=e.onFocus;C===void 0&&(C=M);var u=e.onBlur;u===void 0&&(u=M);var p=e.value,N=e.getCaretBoundary;N===void 0&&(N=er);var V=e.isValidInputCharacter;V===void 0&&(V=L);var I=e.isCharacterSame,T=de(e,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),K=rr(p,g,!!S,l,c,h),ae=K[0],E=ae.formattedValue,q=ae.numAsString,ve=K[1],$=j.useRef(),Y=j.useRef({formattedValue:E,numAsString:q}),ne=function(i,o){Y.current={formattedValue:i.formattedValue,numAsString:i.value},ve(i,o)},ie=j.useState(!1),ge=ie[0],he=ie[1],U=j.useRef(null),O=j.useRef({setCaretTimeout:null,focusTimeout:null});j.useEffect(function(){return he(!0),function(){clearTimeout(O.current.setCaretTimeout),clearTimeout(O.current.focusTimeout)}},[]);var pe=l,H=function(i,o){var m=parseFloat(o);return{formattedValue:i,value:o,floatValue:isNaN(m)?void 0:m}},R=function(i,o,m){i.selectionStart===0&&i.selectionEnd===i.value.length||(te(i,o),O.current.setCaretTimeout=setTimeout(function(){i.value===m&&i.selectionStart!==o&&te(i,o)},0))},B=function(i,o,m){return z(i,o,N(i),m)},Q=function(i,o,m){var w=N(o),k=Ze(o,E,i,m,w,V,I);return k=z(o,k,w),k},xe=function(i){var o=i.formattedValue;o===void 0&&(o="");var m=i.input,w=i.source,k=i.event,b=i.numAsString,x;if(m){var F=i.inputValue||m.value,_=ee(m);m.value=o,x=Q(F,o,_),x!==void 0&&R(m,x,o)}o!==E&&ne(H(o,b),{event:k,source:w})};j.useEffect(function(){var i=Y.current,o=i.formattedValue,m=i.numAsString;(E!==o||q!==m)&&ne(H(E,q),{event:void 0,source:G.props})},[E,q]);var ye=U.current?ee(U.current):void 0,Ne=typeof window<"u"?j.useLayoutEffect:j.useEffect;Ne(function(){var i=U.current;if(E!==Y.current.formattedValue&&i){var o=Q(Y.current.formattedValue,E,ye);i.value=E,R(i,o,E)}},[E]);var we=function(i,o,m){var w=o.target,k=$.current?ze($.current,w.selectionEnd):Je(E,i),b=Object.assign(Object.assign({},k),{lastValue:E}),x=c(i,b),F=pe(x);if(x=c(F,void 0),A&&!A(H(F,x))){var _=o.target,P=ee(_),X=Q(i,E,P);return _.value=E,R(_,X,E),!1}return xe({formattedValue:F,numAsString:x,inputValue:i,event:o,source:m,input:o.target}),!0},W=function(i,o){o===void 0&&(o=0);var m=i.selectionStart,w=i.selectionEnd;$.current={selectionStart:m,selectionEnd:w+o}},be=function(i){var o=i.target,m=o.value,w=we(m,i,G.event);w&&v(i),$.current=void 0},Se=function(i){var o=i.target,m=i.key,w=o.selectionStart,k=o.selectionEnd,b=o.value;b===void 0&&(b="");var x;m==="ArrowLeft"||m==="Backspace"?x=Math.max(w-1,0):m==="ArrowRight"?x=Math.min(w+1,b.length):m==="Delete"&&(x=w);var F=0;m==="Delete"&&w===k&&(F=1);var _=m==="ArrowLeft"||m==="ArrowRight";if(x===void 0||w!==k&&!_){y(i),W(o,F);return}var P=x;if(_){var X=m==="ArrowLeft"?"left":"right";P=B(b,x,X),P!==x&&i.preventDefault()}else m==="Delete"&&!V(b[x])?P=B(b,x,"right"):m==="Backspace"&&!V(b[x])&&(P=B(b,x,"left"));P!==x&&R(o,P,b),y(i),W(o,F)},Ce=function(i){var o=i.target,m=function(){var w=o.selectionStart,k=o.selectionEnd,b=o.value;if(b===void 0&&(b=""),w===k){var x=B(b,w);x!==w&&R(o,x,b)}};m(),requestAnimationFrame(function(){m()}),f(i),W(o)},je=function(i){i.persist&&i.persist();var o=i.target,m=i.currentTarget;U.current=o,O.current.focusTimeout=setTimeout(function(){var w=o.selectionStart,k=o.selectionEnd,b=o.value;b===void 0&&(b="");var x=B(b,w);x!==w&&!(w===0&&k===b.length)&&R(o,x,b),C(Object.assign(Object.assign({},i),{currentTarget:m}))},0)},Ve=function(i){U.current=null,clearTimeout(O.current.focusTimeout),clearTimeout(O.current.setCaretTimeout),u(i)},Ee=ge&&Qe()?"numeric":void 0,oe=Object.assign({inputMode:Ee},T,{type:r,value:E,onChange:be,onKeyDown:Se,onMouseUp:Ce,onFocus:je,onBlur:Ve});if(t==="text")return n?D.createElement(D.Fragment,null,n(E,T)||null):D.createElement("span",Object.assign({},T,{ref:s}),E);if(a){var Ae=a;return D.createElement(Ae,Object.assign({},oe,{ref:s}))}return D.createElement("input",Object.assign({},oe,{ref:s}))}function ir(e,r){var t=r.format,a=r.allowEmptyFormatting,n=r.mask,s=r.patternChar;if(s===void 0&&(s="#"),e===""&&!a)return"";for(var l=0,c=t.split(""),g=0,S=t.length;g<S;g++)t[g]===s&&(c[g]=e[l]||me(n,l),l+=1);return c.join("")}function or(e,r,t){r===void 0&&(r=We(e));var a=t.format,n=t.patternChar;n===void 0&&(n="#");var s=r.from,l=r.to,c=r.lastValue;c===void 0&&(c="");var g=function(u){return a[u]===n},S=function(u,p){for(var N="",V=0;V<u.length;V++)g(p+V)&&L(u[V])&&(N+=u[V]);return N},h=function(u){return u.replace(/[^0-9]/g,"")};if(!a.match(/\d/))return h(e);if((c===""||s.end-s.start===c.length)&&e.length===a.length){for(var A="",v=0;v<e.length;v++)if(g(v))L(e[v])&&(A+=e[v]);else if(e[v]!==a[v])return h(e);return A}var y=c.substring(0,s.start),f=e.substring(l.start,l.end),C=c.substring(s.end);return""+S(y,0)+h(f)+S(C,s.end)}function ur(e,r){var t=r.format,a=r.mask,n=r.patternChar;n===void 0&&(n="#");var s=Array.from({length:e.length+1}).map(function(){return!0}),l=0,c=-1,g={};t.split("").forEach(function(v,y){var f=void 0;v===n&&(l++,f=me(a,l-1),c===-1&&e[y]===f&&(c=y)),g[y]=f});for(var S=function(v){return t[v]===n&&e[v]!==g[v]},h=0,A=s.length;h<A;h++)s[h]=h===c||S(h)||S(h-1);return s[t.indexOf(n)]=!0,s}function sr(e){var r=e.mask;if(r){var t=r==="string"?r:r.toString();if(t.match(/\d/g))throw new Error("Mask "+r+" should not contain numeric character;")}}function lr(e,r){return e===""?!0:!(r!=null&&r.match(/\d/))&&typeof e=="string"&&(!!e.match(/^\d+$/)||e==="")}function cr(e){e.mask,e.allowEmptyFormatting;var r=e.format,t=e.inputMode;t===void 0&&(t="numeric");var a=e.onKeyDown;a===void 0&&(a=M);var n=e.patternChar;n===void 0&&(n="#");var s=e.value,l=e.defaultValue,c=e.valueIsNumericString,g=de(e,["mask","allowEmptyFormatting","format","inputMode","onKeyDown","patternChar","value","defaultValue","valueIsNumericString"]);sr(e);var S=function(f){return ur(f,e)},h=function(f){var C=f.key,u=f.target,p=u.selectionStart,N=u.selectionEnd,V=u.value;if(p!==N){a(f);return}var I=p;if(C==="Backspace"||C==="Delete"){var T="right";if(C==="Backspace"){for(;I>0&&r[I-1]!==n;)I--;T="left"}else{for(var K=r.length;I<K&&r[I]!==n;)I++;T="right"}I=z(V,I,S(V),T)}else r[I]!==n&&C!=="ArrowLeft"&&C!=="ArrowRight"&&(I=z(V,I+1,S(V),"right"));I!==p&&te(u,I),a(f)},A=J(s)?l:s,v=c??lr(A,r),y=Object.assign(Object.assign({},e),{valueIsNumericString:v});return Object.assign(Object.assign({},g),{value:s,defaultValue:l,valueIsNumericString:v,inputMode:t,format:function(f){return ir(f,y)},removeFormatting:function(f,C){return or(f,C,y)},getCaretBoundary:S,onKeyDown:h})}function fr(e){var r=cr(e);return D.createElement(nr,Object.assign({},r))}const dr=()=>{var C;const[e,r]=j.useState(null),[t,a]=j.useState({});j.useState(!1);const[n,s]=j.useState(!1);j.useEffect(()=>{(async()=>{if(Me("user_login"))try{const N=await re();a(N)}catch(N){console.error("Invalid token",N)}})()},[]);const{register:l,handleSubmit:c,formState:{errors:g},control:S,setValue:h}=Re({defaultValues:{userName:"",email:"",phone:"",country:null,city:"",shopName:"",pickupAddress:"",sellerEmail:"",sellerPhone:""}});j.useEffect(()=>{var u;(u=t==null?void 0:t.roles)!=null&&u.some(p=>p.roleName==="shop")?(async()=>{try{const N=await Ue();N?(r(N),A(N)):(r(null),v(t))}catch(N){console.error("Error fetching shop data",N),v(t)}})():v(t)},[t]);const A=u=>{h("shopName",u.shop_name||""),h("pickupAddress",u.address||""),h("sellerEmail",u.owner_id.email||""),h("sellerPhone",u.phone_number||""),h("userName",u.owner_id.userName||""),h("email",u.owner_id.email||""),h("phone",u.owner_id.phoneNumber||"")},v=u=>{console.log("userInfo",u),h("userName",u.userName||""),h("email",u.email||""),h("phone",u.phoneNumber||""),h("shopName",""),h("Address",u&&u.address||""),h("sellerEmail",""),h("sellerPhone","")},y=u=>{console.log(u),Oe.success("Profile updated successfully")},f=((C=t==null?void 0:t.roles)==null?void 0:C.map(u=>u.roleName))||[];return d.jsx(se,{className:"card flex flex-col gap-[30px] md:gap-12 md:row-start-2 md:col-span-2 md:!pb-[50px] xl:row-start-1 xl:col-start-2 xl:col-span-1",children:f.includes("admin")?d.jsxs("div",{className:"flex flex-col gap-5",children:[d.jsx("h5",{children:"My Profile Details"}),d.jsxs("form",{onSubmit:c(y),children:[d.jsx("div",{className:"grid gap-4 md:grid-cols-1 md:gap-5",children:d.jsxs("div",{className:"grid gap-4",children:[d.jsxs("div",{className:"field-wrapper",children:[d.jsx("label",{className:"field-label",htmlFor:"userName",children:"Name"}),d.jsx("input",{className:Z("field-input",{"field-input--error":g.userName}),type:"text",id:"userName",placeholder:t.userName||"Name",...l("userName",{required:!0})}),g.userName&&d.jsx("p",{className:"error-message",children:"Name is required"})]}),d.jsxs("div",{className:"field-wrapper",children:[d.jsx("label",{className:"field-label",htmlFor:"email",children:"Email"}),d.jsx("input",{className:Z("field-input",{"field-input--error":g.email}),type:"text",id:"email",placeholder:t.email||"Email",...l("email",{required:!0,pattern:/^\S+@\S+$/i})}),g.email&&d.jsx("p",{className:"error-message",children:"Valid email is required"})]}),d.jsxs("div",{className:"field-wrapper",children:[d.jsx("label",{className:"field-label",htmlFor:"phone",children:"Phone Number"}),d.jsx(De,{name:"phone",control:S,render:({field:u})=>d.jsx(fr,{value:u.value,format:"+#-###-###-####",placeholder:t.phoneNumber||"Phone Number",className:Z("field-input",{"field-input--error":g.phone}),getInputRef:u.ref})}),g.phone&&d.jsx("p",{className:"error-message",children:"Phone number is required"})]})]})}),d.jsxs("div",{className:"flex justify-between mt-2.5 w-full",children:[d.jsx("div",{className:"flex w-full justify-between mt-2.5",children:d.jsx("button",{className:"text-red font-bold",onClick:()=>s(!0),children:"Change Password"})}),d.jsx("form",{onSubmit:c(y),className:"",children:d.jsx("button",{className:"btn btn--primary w-full mt-5 md:w-fit md:px-[70px]",type:"submit",children:"Save Changes"})})]})]})]}):d.jsx("div",{children:"Không có quyền truy cập"})})},br=()=>d.jsxs(d.Fragment,{children:[d.jsx(Ie,{title:"Settings"}),d.jsxs("div",{className:"widgets-grid xl:!grid-cols-[340px,_minmax(0,1fr)]",children:[d.jsx(Le,{}),d.jsx(dr,{})]})]});export{br as default};
