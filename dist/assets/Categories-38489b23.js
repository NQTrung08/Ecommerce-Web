import{j as s,g as R,k as H,Q as i}from"./index-f10ef397.js";import{a as t,O as P,Q as D,U as Y,V as K,X as Z,Y as q,Z as z,$ as G}from"./antd-2f34d53b.js";import{c as J,u as U,a as ee,b as re,d as se}from"./categorie-fd82ab7c.js";import{P as ae}from"./PageHeader-bcdf1bbb.js";/* empty css                      */import"./mui-8e3bcfed.js";import"./config-44cbe1ad.js";import"./DocumentTitle-eca67fa7.js";const ue=()=>{var T;const[l,y]=t.useState(null),[oe,w]=t.useState([]),[p,V]=t.useState([]),[m,b]=t.useState(""),[g,h]=t.useState(null),[x,u]=t.useState(null),[I,N]=t.useState(!1),[n,_]=t.useState("create"),[F,E]=t.useState(!0);t.useEffect(()=>{f()},[]);const f=async()=>{try{const e=await J();w(v(e)),V(j(e)),E(!1)}catch(e){console.error("Failed to fetch categories",e)}},L=e=>{console.log(e)},O=(e,r)=>{console.log("Trigger Select",e,r)},A=(e,r)=>{console.log("Trigger Expand",e,r)},M=async e=>{const r=e.dragNode,a=e.node;if(!a||!r)return;const o=r.key.split("-").pop(),c=a.key.split("-"),S=c.slice(0,c.length-1).join("-"),k=a.pos.split("-").pop(),B=S===""?null:S;try{a.dragOver?await U({categoryIds:[o],newParentId:c[c.length-1],newIndex:k}):await U({categoryIds:[o],newParentId:B,newIndex:k}),i.success("Cập nhật ngành hàng thành công."),f()}catch(Q){console.error("Error updating category:",Q),i.error("Error updating category.")}},v=(e,r=0)=>{let a=[];return e.forEach(o=>{a.push({category_name:o.category_name,_id:o._id,parent_id:o.parent_id,level:r}),o.children&&o.children.length>0&&(a=a.concat(v(o.children,r+1)))}),a},j=e=>({name:"Categories",children:e.map(r=>({name:r.category_name,id:r._id,parentId:r.parent_id,children:r.children?j(r.children).children:[]}))}),C=(e,r="")=>{var o;const a=r?`${r}-${e.id}`:e.id;return{title:s.jsxDEV("span",{children:[e.name,s.jsxDEV(D,{className:"ml-2 text-blue-500",onClick:()=>d("create",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:100,columnNumber:11},globalThis),s.jsxDEV(z,{className:"ml-2 text-green-darker",onClick:()=>d("edit",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:101,columnNumber:11},globalThis),s.jsxDEV(G,{className:"ml-2 text-rose-500",onClick:()=>d("delete",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:102,columnNumber:11},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:98,columnNumber:14},globalThis),key:a,isLeaf:e.children&&e.children.length===0,children:((o=e.children)==null?void 0:o.map(c=>C(c,a)))||[]}},d=(e,r=null)=>{_(e),y(r),b(r?r.name:""),h(null),u(null),N(!0)},X=e=>{const r=e.fileList[0];r&&(h(r.originFileObj),u(URL.createObjectURL(r.originFileObj)))},$=async()=>{if(!g&&n!=="delete"){i.error("Không có ảnh nào được chọn.");return}try{n==="create"&&m?(await ee(l.id?l.id:"",m,g),i.success("Tạo ngành hàng thành công."),h(null),u(null)):n==="edit"&&l?(await re(l.id,{parent_id:l.parentId,category_name:m,file:g}),i.success("Đã cập nhật ngành hàng thành công.")):n==="delete"&&l&&(await se(l.id),i.success("Đã xóa ngành hàng thành công.")),f(),W(),N(!1),E(!1)}catch{i.error(`Lỗi khi ${n} ngành hàng.`)}};if(F)return s.jsxDEV(R,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:153,columnNumber:25},globalThis);const W=()=>{b(""),h(null),u(null)};return s.jsxDEV("div",{children:[s.jsxDEV(ae,{title:"Quản lý ngành hàng"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:160,columnNumber:7},globalThis),s.jsxDEV(H,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:161,columnNumber:7},globalThis),s.jsxDEV("div",{className:"w-full",children:[s.jsxDEV(P,{type:"primary",icon:s.jsxDEV(D,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:164,columnNumber:38},globalThis),onClick:()=>d("create"),className:"mb-4",children:"Tạo ngành hàng mới"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:164,columnNumber:9},globalThis),s.jsxDEV(Y,{className:"draggable-tree",multiple:!0,draggable:!0,defaultExpandAll:!0,showIcon:!1,onDragEnter:L,onDrop:M,onSelect:O,onExpand:A,treeData:(T=p==null?void 0:p.children)==null?void 0:T.map(e=>C(e))},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:168,columnNumber:9},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:163,columnNumber:7},globalThis),s.jsxDEV(K,{title:n==="create"?"Tạo ngành hàng mới":n==="edit"?"Chỉnh sửa ngành hàng":n==="delete"?"Xóa ngành hàng":"Thao tác ngành hàng",open:I,onOk:$,onCancel:()=>{N(!1),W()},okText:n==="delete"?"Xóa":"Lưu",cancelText:"Hủy",style:{top:"50%",transform:"translateY(-100%) translateX(100%)"},children:[n!=="delete"&&s.jsxDEV(s.Fragment,{children:[s.jsxDEV(Z,{value:m,onChange:e=>b(e.target.value),placeholder:"Category Name",className:"mb-2"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:180,columnNumber:13},globalThis),s.jsxDEV(q,{beforeUpload:()=>!1,onChange:X,children:s.jsxDEV(P,{children:"Tải hình ảnh"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:182,columnNumber:15},globalThis)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:181,columnNumber:13},globalThis),x&&g&&s.jsxDEV("img",{src:x,alt:"Preview",className:"mt-2 w-full h-32 object-cover"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:184,columnNumber:38},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:179,columnNumber:33},globalThis),n==="delete"&&s.jsxDEV("p",{children:"Bạn có chắc chắn muốn xóa ngành hàng này?"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:186,columnNumber:33},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:171,columnNumber:7},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:159,columnNumber:10},globalThis)};export{ue as default};
