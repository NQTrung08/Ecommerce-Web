import{j as s,L as X,k as Y,Q as l}from"./index-c34e661e.js";import{a as n,O as T,Q as D,U as H,V as K,X as Z,Y as q,Z as z,$ as G}from"./antd-f8b54f9d.js";import{c as J,u as U,a as ee,b as re,d as se}from"./categorie-c21aaf5e.js";import{P as ae}from"./PageHeader-671d5d99.js";/* empty css                      */import"./mui-33c18219.js";import"./config-6a5e32b1.js";import"./DocumentTitle-3f6fed6e.js";const he=()=>{var S;const[c,w]=n.useState(null),[oe,y]=n.useState([]),[u,V]=n.useState([]),[m,h]=n.useState(""),[d,p]=n.useState(null),[x,b]=n.useState(null),[I,N]=n.useState(!1),[t,_]=n.useState("create"),[F,v]=n.useState(!0);n.useEffect(()=>{f()},[]);const f=async()=>{try{const e=await J();y(E(e)),V(j(e)),v(!1)}catch(e){console.error("Failed to fetch categories",e)}},L=e=>{console.log(e)},O=(e,r)=>{console.log("Trigger Select",e,r)},A=(e,r)=>{console.log("Trigger Expand",e,r)},$=async e=>{const r=e.dragNode,a=e.node;if(!a||!r)return;const o=r.key.split("-").pop(),i=a.key.split("-"),k=i.slice(0,i.length-1).join("-"),P=a.pos.split("-").pop(),Q=k===""?null:k;try{a.dragOver?await U({categoryIds:[o],newParentId:i[i.length-1],newIndex:P}):await U({categoryIds:[o],newParentId:Q,newIndex:P}),l.success("Cập nhật ngành hàng thành công."),f()}catch(R){console.error("Error updating category:",R),l.error("Error updating category.")}},E=(e,r=0)=>{let a=[];return e.forEach(o=>{a.push({category_name:o.category_name,_id:o._id,parent_id:o.parent_id,level:r}),o.children&&o.children.length>0&&(a=a.concat(E(o.children,r+1)))}),a},j=e=>({name:"Categories",children:e.map(r=>({name:r.category_name,id:r._id,parentId:r.parent_id,children:r.children?j(r.children).children:[]}))}),C=(e,r="")=>{var o;const a=r?`${r}-${e.id}`:e.id;return{title:s.jsxDEV("span",{children:[e.name,s.jsxDEV(D,{className:"ml-2 text-blue-500",onClick:()=>g("create",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:100,columnNumber:11},globalThis),s.jsxDEV(z,{className:"ml-2 text-green-darker",onClick:()=>g("edit",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:101,columnNumber:11},globalThis),s.jsxDEV(G,{className:"ml-2 text-rose-500",onClick:()=>g("delete",e)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:102,columnNumber:11},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:98,columnNumber:14},globalThis),key:a,isLeaf:e.children&&e.children.length===0,children:((o=e.children)==null?void 0:o.map(i=>C(i,a)))||[]}},g=(e,r=null)=>{_(e),w(r),h(r?r.name:""),p(null),b(null),N(!0)},M=e=>{const r=e.fileList[0];r&&(p(r.originFileObj),b(URL.createObjectURL(r.originFileObj)))},B=async()=>{if(!d&&t!=="delete"){l.error("Không có ảnh nào được chọn.");return}try{t==="create"&&m?(await ee("",m,d),l.success("Tạo ngành hàng thành công.")):t==="edit"&&c?(await re(c.id,{parent_id:c.parentId,category_name:m,file:d}),l.success("Đã cập nhật ngành hàng thành công.")):t==="delete"&&c&&(await se(c.id),l.success("Đã xóa ngành hàng thành công.")),f(),W(),N(!1),v(!1)}catch{l.error(`Lỗi khi ${t} ngành hàng.`)}};if(F)return s.jsxDEV(X,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:151,columnNumber:25},globalThis);const W=()=>{h(""),p(null),b(null)};return s.jsxDEV("div",{children:[s.jsxDEV(ae,{title:"Quản lý ngành hàng"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:158,columnNumber:7},globalThis),s.jsxDEV(Y,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:159,columnNumber:7},globalThis),s.jsxDEV("div",{className:"w-full",children:[s.jsxDEV(T,{type:"primary",icon:s.jsxDEV(D,{},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:162,columnNumber:38},globalThis),onClick:()=>g("create"),className:"mb-4",children:"Tạo ngành hàng mới"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:162,columnNumber:9},globalThis),s.jsxDEV(H,{className:"draggable-tree",multiple:!0,draggable:!0,defaultExpandAll:!0,showIcon:!1,onDragEnter:L,onDrop:$,onSelect:O,onExpand:A,treeData:(S=u==null?void 0:u.children)==null?void 0:S.map(e=>C(e))},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:166,columnNumber:9},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:161,columnNumber:7},globalThis),s.jsxDEV(K,{title:`${t.charAt(0).toUpperCase()+t.slice(1)} ngành hàng`,open:I,onOk:B,onCancel:()=>{N(!1),W()},okText:t==="delete"?"Delete":"Save",cancelText:"Cancel",style:{top:"50%",transform:"translateY(-50%) translateX(70%)"},children:[t!=="delete"&&s.jsxDEV(s.Fragment,{children:[s.jsxDEV(Z,{value:m,onChange:e=>h(e.target.value),placeholder:"Category Name",className:"mb-2"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:177,columnNumber:13},globalThis),s.jsxDEV(q,{beforeUpload:()=>!1,onChange:M,children:s.jsxDEV(T,{children:"Tải hình ảnh"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:179,columnNumber:15},globalThis)},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:178,columnNumber:13},globalThis),x&&s.jsxDEV("img",{src:x,alt:"Preview",className:"mt-2 w-full h-32 object-cover"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:181,columnNumber:30},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:176,columnNumber:33},globalThis),t==="delete"&&s.jsxDEV("p",{children:"Bạn có chắc chắn muốn xóa ngành hàng này?"},void 0,!1,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:183,columnNumber:33},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:169,columnNumber:7},globalThis)]},void 0,!0,{fileName:"/Users/manh/WorkSpoce/Private/Ecommerce-Web/src/pages/Categories.jsx",lineNumber:157,columnNumber:10},globalThis)};export{he as default};
